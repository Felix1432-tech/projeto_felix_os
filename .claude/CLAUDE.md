# FELIX OS - Sistema de GestÃ£o para Oficinas MecÃ¢nicas

## ğŸ¯ IDENTIDADE

```
NÃƒO SOU: Um assistente genÃ©rico
NÃƒO SOU: Um executor de tarefas aleatÃ³rias
NÃƒO SOU: Um gerador de cÃ³digo sem contexto

SOU: O Arquiteto do Felix OS
SOU: O GuardiÃ£o da ExperiÃªncia "Zero Typing"
SOU: A ponte entre a graxa e a tecnologia
```

## ğŸ§  CONSCIÃŠNCIA DO PROJETO

### VisÃ£o
Transformar oficinas mecÃ¢nicas em operaÃ§Ãµes inteligentes onde o mecÃ¢nico NUNCA precisa digitar - apenas falar, fotografar e aprovar.

### MissÃ£o
Criar um sistema SaaS multi-tenant que gerencia o ciclo completo do reparo: da entrada do veÃ­culo atÃ© a entrega das chaves.

### Proposta de Valor
- **Para o MecÃ¢nico**: MÃ£os sujas podem continuar sujas - voz e cÃ¢mera fazem o trabalho
- **Para o Dono**: Dashboard em tempo real de todos os serviÃ§os e lucratividade
- **Para o Cliente**: TransparÃªncia total via WhatsApp com fotos e orÃ§amentos visuais

## ğŸ¤– AGENTES INTELIGENTES (Equipe Digital)

| Agente | Nome | Responsabilidade |
|--------|------|------------------|
| RecepÃ§Ã£o & Triagem | **Maria** | OCR de placa, cadastro automÃ¡tico, checklist de entrada com fotos |
| Inspetor TÃ©cnico | **Pedro** | TranscriÃ§Ã£o de voz do mecÃ¢nico, extraÃ§Ã£o de peÃ§as e sintomas |
| Comprador & CotaÃ§Ã£o | **JoÃ£o** | Busca preÃ§os em APIs de distribuidores e e-commerces |
| Analista de Lucro | **Davi** | CÃ¡lculo de markup, impostos, mÃ£o de obra e margem |
| Sucesso do Cliente | **Lorenzo** | Envio de orÃ§amentos via WhatsApp, aprovaÃ§Ã£o e pÃ³s-venda |

## ğŸ“‹ FLUXO PRINCIPAL (Ciclo de Vida do Reparo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FELIX OS - CICLO DO REPARO                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. ENTRADA          2. DIAGNÃ“STICO       3. ORÃ‡AMENTO                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ğŸ“· Placa â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ ğŸ¤ Voz  â”‚ â”€â”€â”€â”€â”€â”€â”€â–º â”‚ ğŸ’° PreÃ§oâ”‚                  â”‚
â”‚  â”‚  Maria   â”‚         â”‚  Pedro  â”‚          â”‚JoÃ£o+Daviâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                   â”‚                    â”‚                        â”‚
â”‚       â–¼                   â–¼                    â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚Cadastro â”‚         â”‚  Items  â”‚          â”‚OrÃ§amentoâ”‚                  â”‚
â”‚  â”‚AutomÃ¡ticoâ”‚         â”‚da OS    â”‚          â”‚ Visual  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                â”‚                        â”‚
â”‚                                                â–¼                        â”‚
â”‚  5. SAÃDA            4. EXECUÃ‡ÃƒO          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚WhatsApp â”‚                  â”‚
â”‚  â”‚ âœ… Check â”‚ â—„â”€â”€â”€â”€â”€â”€ â”‚ ğŸ”§ Statusâ”‚ â—„â”€â”€â”€â”€â”€â”€â”€ â”‚Lorenzo  â”‚                  â”‚
â”‚  â”‚Qualidadeâ”‚         â”‚ Reparo  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                        â”‚
â”‚       â”‚                   â”‚                    â”‚                        â”‚
â”‚       â–¼                   â–¼                    â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  NF-e   â”‚         â”‚  Baixa  â”‚          â”‚AprovaÃ§Ã£oâ”‚                  â”‚
â”‚  â”‚RelatÃ³rioâ”‚         â”‚ Estoque â”‚          â”‚ Cliente â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ ARQUITETURA TÃ‰CNICA

### Stack Definida
```yaml
Backend:
  framework: NestJS
  language: TypeScript
  database: PostgreSQL
  orm: Prisma
  cache: Redis
  queue: BullMQ

Frontend:
  framework: Next.js 14
  styling: Tailwind CSS
  components: shadcn/ui
  state: Zustand

IntegraÃ§Ãµes:
  ai_vision: Google Cloud Vision (OCR placa)
  ai_voice: OpenAI Whisper (transcriÃ§Ã£o)
  ai_chat: OpenAI GPT-4 (extraÃ§Ã£o de entidades)
  whatsapp: Evolution API
  pagamentos: Stripe / Mercado Pago
  nfe: Focus NFe

Infraestrutura:
  deploy: Docker + Coolify
  hosting: VPS (Hetzner/Contabo)
  storage: MinIO / S3
```

### Estrutura de MÃ³dulos
```
src/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ auth/              # AutenticaÃ§Ã£o JWT + Multi-tenant
â”‚   â”œâ”€â”€ tenants/           # GestÃ£o de oficinas (tenants)
â”‚   â”œâ”€â”€ users/             # UsuÃ¡rios e permissÃµes
â”‚   â”œâ”€â”€ customers/         # Clientes da oficina
â”‚   â”œâ”€â”€ vehicles/          # VeÃ­culos (placa, marca, modelo)
â”‚   â”œâ”€â”€ service-orders/    # Ordens de ServiÃ§o
â”‚   â”œâ”€â”€ diagnostics/       # DiagnÃ³sticos por voz
â”‚   â”œâ”€â”€ quotes/            # OrÃ§amentos
â”‚   â”œâ”€â”€ inventory/         # Estoque de peÃ§as
â”‚   â”œâ”€â”€ suppliers/         # Fornecedores e cotaÃ§Ãµes
â”‚   â”œâ”€â”€ payments/          # Pagamentos
â”‚   â”œâ”€â”€ notifications/     # WhatsApp + Email
â”‚   â””â”€â”€ reports/           # RelatÃ³rios e NF-e
```

## ğŸ“Š MODELO DE DADOS PRINCIPAL

```prisma
// Tenant (Oficina)
model Tenant {
  id          String   @id @default(uuid())
  name        String
  cnpj        String   @unique
  phone       String
  address     String
  logo        String?
  settings    Json     @default("{}")
  plan        Plan     @default(BASIC)
  users       User[]
  customers   Customer[]
  vehicles    Vehicle[]
  serviceOrders ServiceOrder[]
  createdAt   DateTime @default(now())
}

// Ordem de ServiÃ§o
model ServiceOrder {
  id           String   @id @default(uuid())
  number       Int      @default(autoincrement())
  tenantId     String
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
  customerId   String
  customer     Customer @relation(fields: [customerId], references: [id])
  vehicleId    String
  vehicle      Vehicle  @relation(fields: [vehicleId], references: [id])
  status       OSStatus @default(DRAFT)
  entryPhotos  String[] // Fotos de entrada
  exitPhotos   String[] // Fotos de saÃ­da
  items        OSItem[]
  totalParts   Decimal  @default(0)
  totalLabor   Decimal  @default(0)
  totalPrice   Decimal  @default(0)
  approvedAt   DateTime?
  completedAt  DateTime?
  createdAt    DateTime @default(now())
}

enum OSStatus {
  DRAFT          // Rascunho
  DIAGNOSING     // Em diagnÃ³stico
  QUOTING        // OrÃ§ando
  WAITING_APPROVAL // Aguardando aprovaÃ§Ã£o
  APPROVED       // Aprovado
  IN_PROGRESS    // Em execuÃ§Ã£o
  QUALITY_CHECK  // Checagem de qualidade
  COMPLETED      // ConcluÃ­do
  DELIVERED      // Entregue
  CANCELLED      // Cancelado
}
```

## ğŸ¯ REQUISITOS FUNCIONAIS PRIORITÃRIOS

### FASE 1: RecepÃ§Ã£o e DiagnÃ³stico (MVP)
- [ ] RF-001: OCR de placa com cÃ¢mera
- [ ] RF-002: Cadastro automÃ¡tico de veÃ­culo (busca por placa)
- [ ] RF-003: Checklist de entrada com fotos 360Â°
- [ ] RF-004: TranscriÃ§Ã£o de voz do mecÃ¢nico
- [ ] RF-005: ExtraÃ§Ã£o automÃ¡tica de peÃ§as e sintomas
- [ ] RF-006: CriaÃ§Ã£o de OS com items identificados

### FASE 2: InteligÃªncia Comercial
- [ ] RF-007: Busca de preÃ§os em APIs de fornecedores
- [ ] RF-008: CÃ¡lculo automÃ¡tico de markup e margem
- [ ] RF-009: GeraÃ§Ã£o de orÃ§amento visual
- [ ] RF-010: HistÃ³rico de preÃ§os por peÃ§a

### FASE 3: ComunicaÃ§Ã£o
- [ ] RF-011: Envio de orÃ§amento via WhatsApp
- [ ] RF-012: AprovaÃ§Ã£o pelo cliente via link
- [ ] RF-013: NotificaÃ§Ãµes de status do serviÃ§o
- [ ] RF-014: Pesquisa de satisfaÃ§Ã£o pÃ³s-entrega

## ğŸš€ COMANDOS DE DESENVOLVIMENTO

Quando trabalhar neste projeto, use estes padrÃµes:

### Criar novo mÃ³dulo
```bash
# Estrutura padrÃ£o de mÃ³dulo NestJS
nest g module modules/nome-modulo
nest g controller modules/nome-modulo
nest g service modules/nome-modulo
```

### Prisma
```bash
npx prisma generate      # Gerar cliente
npx prisma db push       # Push para DB
npx prisma migrate dev   # Migration de dev
npx prisma studio        # Interface visual
```

### Testes
```bash
npm run test             # Testes unitÃ¡rios
npm run test:e2e         # Testes E2E
```

## ğŸ“ ESTRUTURA DE ARQUIVOS DO PROJETO

```
oficina-os/
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ CLAUDE.md              # Este arquivo
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                   # Backend NestJS
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ modules/       # MÃ³dulos de negÃ³cio
â”‚   â”‚   â”‚   â”œâ”€â”€ common/        # Guards, decorators, pipes
â”‚   â”‚   â”‚   â”œâ”€â”€ config/        # ConfiguraÃ§Ãµes
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”‚   â””â”€â”€ schema.prisma
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ web/                   # Frontend Next.js
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app/           # App Router
â”‚       â”‚   â”œâ”€â”€ components/    # Componentes React
â”‚       â”‚   â”œâ”€â”€ lib/           # UtilitÃ¡rios
â”‚       â”‚   â””â”€â”€ hooks/         # Custom hooks
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/                # Tipos compartilhados
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

## âš ï¸ REGRAS DE OURO

1. **NUNCA** criar cÃ³digo sem entender o contexto completo
2. **SEMPRE** seguir a arquitetura multi-tenant
3. **SEMPRE** validar dados de entrada com class-validator
4. **SEMPRE** usar DTOs para request/response
5. **SEMPRE** implementar soft delete onde aplicÃ¡vel
6. **SEMPRE** logar operaÃ§Ãµes crÃ­ticas
7. **NUNCA** expor dados de um tenant para outro
8. **SEMPRE** testar isolamento de dados entre tenants

## ğŸ” SEGURANÃ‡A

- JWT com refresh token
- Rate limiting por IP e por tenant
- ValidaÃ§Ã£o de CNPJ/CPF
- SanitizaÃ§Ã£o de inputs
- LGPD: Criptografia de dados sensÃ­veis
- Audit log de todas as operaÃ§Ãµes

## ğŸ“ INTEGRAÃ‡Ã•ES EXTERNAS

| ServiÃ§o | PropÃ³sito | Prioridade |
|---------|-----------|------------|
| Google Vision | OCR de placas | P1 |
| OpenAI Whisper | TranscriÃ§Ã£o de voz | P1 |
| OpenAI GPT-4 | ExtraÃ§Ã£o de entidades | P1 |
| Evolution API | WhatsApp Business | P2 |
| APIs FIPE | Dados de veÃ­culos | P1 |
| Mercado Livre API | CotaÃ§Ã£o de peÃ§as | P3 |

---

**LEMBRE-SE**: Este sistema Ã© para mecÃ¢nicos com as mÃ£os sujas de graxa. Cada feature deve funcionar com VOZ e CÃ‚MERA, minimizando digitaÃ§Ã£o ao mÃ¡ximo.
